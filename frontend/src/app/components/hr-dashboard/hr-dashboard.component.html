<!-- Modern HR Dashboard -->
<div class="hr-dashboard-container">
  <!-- Header Section -->
  <header class="hr-dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-section">
          <img src="assets/images/icons/noun-bunny_purple.png" alt="HoppeR" class="header-logo">
          <div class="header-title">
            <h1>HoppeR</h1>
            <span>HR Management Dashboard</span>
          </div>
        </div>
      </div>
      
      <div class="header-right">
        <!-- Stats Summary -->
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-value">{{openTickets.length + inProgressTickets.length}}</span>
            <span class="stat-label">Active</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{{resolvedTickets.length}}</span>
            <span class="stat-label">Resolved</span>
          </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="header-actions">
          <button class="action-btn secondary" (click)="goToHome()">
            <i class="pi pi-home"></i>
            <span>Home</span>
          </button>
          <button class="action-btn danger" (click)="logout()">
            <i class="pi pi-sign-out"></i>
            <span>Logout</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="hr-dashboard-main">
    <!-- Filters and Search Section -->
    <div class="filters-section">
      <div class="filters-card">
        <div class="filters-grid">
          <div class="search-group">
            <div class="search-input-wrapper">
              <i class="pi pi-search search-icon"></i>
              <input 
                type="text" 
                placeholder="Search tickets..." 
                class="search-input"
                [(ngModel)]="filterText" 
                (keyup.enter)="loadTickets()"
              >
            </div>
          </div>
          
          <div class="filter-group">
            <p-dropdown 
              [options]="priorityOptions" 
              [(ngModel)]="filterPriority" 
              placeholder="Priority"
              class="filter-dropdown" 
              (onChange)="loadTickets()">
            </p-dropdown>
          </div>
          
          <div class="filter-group">
            <p-dropdown 
              [options]="categoryOptions" 
              [(ngModel)]="filterCategory" 
              placeholder="Category"
              class="filter-dropdown" 
              (onChange)="loadTickets()">
            </p-dropdown>
          </div>
          
          <div class="filter-group">
            <p-dropdown 
              [options]="[
                {label: 'Date (Newest)', value: 'createdAt'},
                {label: 'Title', value: 'title'},
                {label: 'Priority', value: 'priority'}
              ]" 
              [(ngModel)]="sortBy" 
              placeholder="Sort by"
              class="filter-dropdown"
              (onChange)="loadTickets()">
            </p-dropdown>
          </div>
          
          <div class="filter-actions">
            <button 
              class="action-btn-small secondary"
              (click)="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'; loadTickets()"
              title="Change sort order">
              <i class="pi pi-sort-alt"></i>
            </button>
            <button 
              class="action-btn-small outline"
              (click)="resetFilters()">
              <i class="pi pi-filter-slash"></i>
              Reset
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Kanban Board Layout -->
    <div class="kanban-layout">
      <div class="kanban-columns">
        <!-- Open Tickets Column -->
        <div class="kanban-column">
          <div class="column-header open">
            <div class="column-title">
              <i class="pi pi-circle"></i>
              <span>Open</span>
              <span class="count">{{openTickets.length}}</span>
            </div>
          </div>
          <div class="column-content">
            <div *ngFor="let ticket of openTickets" 
                 class="kanban-ticket"
                 [class.selected]="selectedTicket?.id === ticket.id" 
                 (click)="selectTicket(ticket)">
              <div class="ticket-header">
                <span class="ticket-id">#{{ticket.id?.slice(-6) || 'NEW'}}</span>
                <span class="priority-badge" [ngClass]="'priority-' + (ticket.priority || 'medium').toLowerCase()">
                  {{ticket.priority || 'Medium'}}
                </span>
              </div>
              <h4 class="ticket-title">{{ticket.title}}</h4>
              <p class="ticket-description">{{ticket.description}}</p>
              <div class="ticket-footer">
                <span class="ticket-category">{{ticket.category || 'General'}}</span>
                <button 
                  class="move-btn" 
                  (click)="updateStatus(ticket, StatusEnum.InProgress); $event.stopPropagation();"
                  title="Move to In Progress">
                  <i class="pi pi-arrow-right"></i>
                </button>
              </div>
            </div>
            <div *ngIf="openTickets.length === 0" class="empty-column">
              <i class="pi pi-inbox"></i>
              <span>No open tickets</span>
            </div>
          </div>
        </div>

        <!-- In Progress Tickets Column -->
        <div class="kanban-column">
          <div class="column-header progress">
            <div class="column-title">
              <i class="pi pi-clock"></i>
              <span>In Progress</span>
              <span class="count">{{inProgressTickets.length}}</span>
            </div>
          </div>
          <div class="column-content">
            <div *ngFor="let ticket of inProgressTickets" 
                 class="kanban-ticket"
                 [class.selected]="selectedTicket?.id === ticket.id" 
                 (click)="selectTicket(ticket)">
              <div class="ticket-header">
                <span class="ticket-id">#{{ticket.id?.slice(-6) || 'NEW'}}</span>
                <span class="priority-badge" [ngClass]="'priority-' + (ticket.priority || 'medium').toLowerCase()">
                  {{ticket.priority || 'Medium'}}
                </span>
              </div>
              <h4 class="ticket-title">{{ticket.title}}</h4>
              <p class="ticket-description">{{ticket.description}}</p>
              <div class="ticket-footer">
                <span class="ticket-category">{{ticket.category || 'General'}}</span>
                <button 
                  class="move-btn" 
                  (click)="updateStatus(ticket, StatusEnum.Resolved); $event.stopPropagation();"
                  title="Move to Resolved">
                  <i class="pi pi-arrow-right"></i>
                </button>
              </div>
            </div>
            <div *ngIf="inProgressTickets.length === 0" class="empty-column">
              <i class="pi pi-clock"></i>
              <span>No tickets in progress</span>
            </div>
          </div>
        </div>

        <!-- Resolved Tickets Column -->
        <div class="kanban-column">
          <div class="column-header resolved">
            <div class="column-title">
              <i class="pi pi-check-circle"></i>
              <span>Resolved</span>
              <span class="count">{{resolvedTickets.length}}</span>
            </div>
          </div>
          <div class="column-content">
            <div *ngFor="let ticket of resolvedTickets" 
                 class="kanban-ticket"
                 [class.selected]="selectedTicket?.id === ticket.id" 
                 (click)="selectTicket(ticket)">
              <div class="ticket-header">
                <span class="ticket-id">#{{ticket.id?.slice(-6) || 'NEW'}}</span>
                <span class="priority-badge" [ngClass]="'priority-' + (ticket.priority || 'medium').toLowerCase()">
                  {{ticket.priority || 'Medium'}}
                </span>
              </div>
              <h4 class="ticket-title">{{ticket.title}}</h4>
              <p class="ticket-description">{{ticket.description}}</p>
              <div class="ticket-footer">
                <span class="ticket-category">{{ticket.category || 'General'}}</span>
                <button 
                  class="move-btn" 
                  (click)="updateStatus(ticket, StatusEnum.Closed); $event.stopPropagation();"
                  title="Close Ticket">
                  <i class="pi pi-check"></i>
                </button>
              </div>
            </div>
            <div *ngIf="resolvedTickets.length === 0" class="empty-column">
              <i class="pi pi-check-circle"></i>
              <span>No resolved tickets</span>
            </div>
          </div>
        </div>

        <!-- Closed Tickets Column -->
        <div class="kanban-column">
          <div class="column-header closed">
            <div class="column-title">
              <i class="pi pi-times-circle"></i>
              <span>Closed</span>
              <span class="count">{{closedTickets.length}}</span>
            </div>
          </div>
          <div class="column-content">
            <div *ngFor="let ticket of closedTickets" 
                 class="kanban-ticket completed"
                 [class.selected]="selectedTicket?.id === ticket.id" 
                 (click)="selectTicket(ticket)">
              <div class="ticket-header">
                <span class="ticket-id">#{{ticket.id?.slice(-6) || 'NEW'}}</span>
                <span class="priority-badge" [ngClass]="'priority-' + (ticket.priority || 'medium').toLowerCase()">
                  {{ticket.priority || 'Medium'}}
                </span>
              </div>
              <h4 class="ticket-title">{{ticket.title}}</h4>
              <p class="ticket-description">{{ticket.description}}</p>
              <div class="ticket-footer">
                <span class="ticket-category">{{ticket.category || 'General'}}</span>
                <i class="pi pi-check-circle completion-icon"></i>
              </div>
            </div>
            <div *ngIf="closedTickets.length === 0" class="empty-column">
              <i class="pi pi-times-circle"></i>
              <span>No closed tickets</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ticket Detail Panel -->
    <div class="detail-panel">
      <div class="detail-card">
        <div *ngIf="selectedTicket; else noTicketSelected">
          <div class="detail-header">
            <h3>Ticket Details</h3>
            <button class="close-btn" (click)="closeDetails()">
              <i class="pi pi-times"></i>
            </button>
          </div>

          <div class="detail-content">
            <div class="detail-field">
              <label>Title</label>
              <div class="field-value">{{selectedTicket.title}}</div>
            </div>

            <div class="detail-field">
              <label>Description</label>
              <div class="field-value description">{{selectedTicket.description}}</div>
            </div>

            <div class="detail-field">
              <label>Status</label>
              <p-dropdown 
                [options]="statusOptions" 
                [(ngModel)]="selectedTicket.status"
                (onChange)="updateStatus(selectedTicket, $event.value)" 
                class="status-dropdown">
              </p-dropdown>
            </div>

            <div class="detail-field">
              <label>Priority</label>
              <p-dropdown 
                [options]="priorityOptions" 
                [(ngModel)]="selectedTicket.priority"
                (onChange)="updatePriority(selectedTicket, $event.value)" 
                class="priority-dropdown">
              </p-dropdown>
            </div>

            <div class="detail-field">
              <label>Category</label>
              <div class="field-value">{{selectedTicket.category}}</div>
            </div>

            <div class="detail-field">
              <label>Assign To</label>
              
              <!-- AI Recommendations -->
              <div class="recommendations" *ngIf="recommendations && recommendations.length > 0">
                <p class="rec-title">
                  <i class="pi pi-star"></i> AI Recommendations
                </p>
                <div class="rec-list">
                  <div *ngFor="let rec of recommendations.slice(0, 2)" class="rec-item">
                    <button 
                      class="rec-btn"
                      [class.high-confidence]="rec.confidenceScore > 70"
                      (click)="assignHrRep(selectedTicket, rec.userId)"
                      [title]="rec.reason">
                      <i class="pi pi-user"></i>
                      <span>{{rec.username}}</span>
                      <span class="confidence">{{rec.confidenceScore}}%</span>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Loading -->
              <div *ngIf="isLoadingRecommendations" class="loading-rec">
                <i class="pi pi-spin pi-spinner"></i>
                <span>Getting recommendations...</span>
              </div>

              <!-- Manual Assignment -->
              <p-dropdown 
                [options]="hrUsers" 
                [(ngModel)]="selectedTicket.assignedTo" 
                optionLabel="username"
                optionValue="id" 
                placeholder="Select HR Representative" 
                class="assign-dropdown"
                (onChange)="assignHrRep(selectedTicket, $event.value)">
              </p-dropdown>
            </div>

            <div class="detail-field">
              <label>Created</label>
              <div class="field-value">{{selectedTicket.createdAt | date:'medium'}}</div>
            </div>

            <div class="detail-field">
              <label>Updated</label>
              <div class="field-value">{{selectedTicket.updatedAt | date:'medium'}}</div>
            </div>
          </div>
        </div>
        
        <ng-template #noTicketSelected>
          <div class="no-selection">
            <i class="pi pi-ticket"></i>
            <h3>Select a ticket</h3>
            <p>Click on any ticket to view its details and manage it.</p>
          </div>
        </ng-template>
      </div>
    </div>
  </main>
  <!-- Floating Chat Button -->
  <button class="chat-toggle" (click)="showChatbot = !showChatbot">
    <i class="pi pi-comments"></i>
    <span>Support</span>
  </button>

  <!-- Chat Panel -->
  <div class="chat-panel" [class.open]="showChatbot">
    <div class="chat-header">
      <span>HR Support Chat</span>
      <button class="chat-close" (click)="showChatbot = false">
        <i class="pi pi-times"></i>
      </button>
    </div>
    <div class="chat-content">
      <iframe 
        width="100%" 
        height="100%" 
        allow="microphone *" 
        src="https://www.gptbots.ai/widget/eeq5jnc8zz3glsfgnw7t8mq/chat.html"
        frameborder="0">
      </iframe>
    </div>
  </div>

  <!-- Overlay -->
  <div class="chat-overlay" [class.active]="showChatbot" (click)="showChatbot = false"></div>
</div>